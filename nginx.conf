# Worker processes ko CPU cores ke barabar set karein
worker_processes auto;

events {
    # Accept maximum number of connections
    worker_connections 1024;
}

http {
    include mime.types; # MIME types include karein
    default_type application/octet-stream; # Default content type

    sendfile on; # Files ko efficient tarike se send karein
    keepalive_timeout 65; # Client connection ko kitni der tak open rakhe

    server {
        listen 80; # Port 80 par listen karein (HTTP)
        server_name localhost; # Server ka naam, Render automatic configure karega

        # Web root directory jahan aapki application files hain
        root /var/www/html;
        index index.php index.html index.htm; # Default files jab directory access ho

        # Static files ko serve karein
        location / {
            try_files $uri $uri/ /index.php?$query_string;
        }

        # PHP files ko PHP-FPM ke through process karein
        location ~ \.php$ {
            try_files $uri =404; # Agar PHP file exist nahi karti to 404 return karein
            fastcgi_split_path_info ^(.+\.php)(/.+)$; # Path info ko split karein
            fastcgi_pass 127.0.0.1:9000; # PHP-FPM service se connect karein jo port 9000 par run ho rahi hai
            fastcgi_index index.php; # Default index file
            include fastcgi_params; # FastCGI parameters include karein
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; # Script ka full path set karein
            fastcgi_param PATH_INFO $fastcgi_path_info; # Path info set karein
        }

        # Dot files (.git, .env, etc.) ko block karein security ke liye
        location ~ /\. {
            deny all;
            access_log off;
            log_not_found off;
        }
    }
}
